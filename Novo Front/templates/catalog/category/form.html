{% extends "base.html" %}
{% block title %}Nova Categoria · MVPSale{% endblock %}

{% block content %}
{% include "partials/breadcrumb.html" with b1="Catálogo" u1="/catalog" b2="Categorias" u2="/catalog/categories" b3="Nova" %}

<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-semibold tracking-tight">Nova Categoria</h1>
    <p class="text-slate-400 text-sm">Preencha as informações abaixo para cadastrar uma nova categoria no catálogo.</p>
  </div>
  <a href="/catalog/categories" class="flex items-center gap-2 text-sm bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg px-3 py-2 transition">
    <i data-lucide="arrow-left" class="w-4 h-4"></i>
    Voltar
  </a>
</div>

<div class="bg-slate-800/40 border border-slate-700 rounded-2xl shadow-lg backdrop-blur-md p-6 max-w-2xl">
  <form id="newCatForm" class="grid grid-cols-1 gap-4">
    <div>
      <label class="block text-sm mb-1 text-slate-300 font-medium">Nome</label>
      <input name="name" placeholder="Ex: Suspensão, Motor, Freios..."
             class="w-full px-3 py-2 rounded-lg bg-slate-900/70 border border-slate-700 text-slate-100 focus:ring-2 focus:ring-emerald-500 outline-none"
             required />
    </div>
    <div>
      <label class="block text-sm mb-1 text-slate-300 font-medium">Ativo</label>
      <select name="active"
              class="w-full px-3 py-2 rounded-lg bg-slate-900/70 border border-slate-700 text-slate-100 focus:ring-2 focus:ring-emerald-500 outline-none">
        <option value="true" selected>Sim</option>
        <option value="false">Não</option>
      </select>
    </div>
    <div class="flex justify-end">
      <button class="inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 transition text-white rounded-lg px-4 py-2 shadow text-sm font-medium">
        <i data-lucide="save" class="w-4 h-4"></i>
        Salvar Categoria
      </button>
    </div>
  </form>
</div>

<script>
document.getElementById('newCatForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = e.currentTarget || e.target;
  const submitBtn = form.querySelector('button[type="submit"], button');
  FormUtils.clearFieldErrors(form);
  FormUtils.setLoading(submitBtn, true);
  const fd = new FormData(form);
  const payload = { name: fd.get('name'), active: fd.get('active') === 'true' };
  try {
    await Http.fetchJson('/api/catalog/categories/', { method:'POST', body: JSON.stringify(payload) });
    Http.toast('Categoria criada com sucesso!','success');
    if(form && typeof form.reset === 'function') form.reset();
    setTimeout(()=> location.href = '/catalog/categories', 800);
  } catch(err) {
    if(err && err.data) FormUtils.showFieldErrors(form, err.data);
    else Http.toast(err.message || 'Erro ao criar categoria','error');
  } finally { FormUtils.setLoading(submitBtn, false); }
});
</script>

<script src="https://unpkg.com/lucide@latest"></script>
<script>lucide.createIcons();</script>
{% endblock %}
