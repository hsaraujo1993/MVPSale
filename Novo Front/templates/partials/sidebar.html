<!-- Mobile drawer -->
<!-- SIDEBAR MOBILE START -->
<div class="md:hidden" x-data="sidebar()" x-init="init()">
  <div class="fixed inset-0 z-40" x-show="sidebarVisible" x-cloak x-transition.opacity>
    <div class="absolute inset-0 bg-slate-900/60" @click="sidebarVisible=false"></div>
  </div>

  <aside class="fixed inset-y-0 left-0 z-50 w-72 border-r border-slate-800 bg-gradient-to-b from-brand-900/95 to-sky-800/80 backdrop-blur-lg shadow-2xl"
         x-show="sidebarVisible" x-cloak
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="-translate-x-full opacity-0"
         x-transition:enter-end="translate-x-0 opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="translate-x-0 opacity-100"
         x-transition:leave-end="-translate-x-full opacity-0"
         @keydown.escape.window="sidebarVisible=false">

    <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800">
      <span class="text-sm font-medium text-slate-300">Menu</span>
      <button class="inline-flex h-8 w-8 items-center justify-center rounded-md hover:bg-slate-800/60"
              aria-label="Fechar menu"
              @click="sidebarVisible=false">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5 text-slate-300" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <nav class="p-4 text-sm space-y-2 overflow-y-auto h-[calc(100vh-3rem)] pr-2">
      <a href="/home" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-gradient-to-br from-brand-700/60 to-brand-900/60 border border-brand-700/50 shadow-md shadow-slate-950/40 hover:from-brand-600/70 hover:to-brand-800/70 focus:outline-none focus:ring-2 focus:ring-sky-500/40">
        <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg>
        <span>Home</span>
      </a>

      <a href="/" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-gradient-to-br from-brand-700/60 to-brand-900/60 border border-brand-700/50 shadow-md shadow-slate-950/40 hover:from-brand-600/70 hover:to-brand-800/70 focus:outline-none focus:ring-2 focus:ring-sky-500/40">
        <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v7h-7zM3 14h7v7H3zM14 14h7v7h-7z"/></svg>
        <span>Dashboard</span>
      </a>

      <!-- Mobile groups -->
      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-brand-800/90 to-brand-900/90 border border-brand-700/70 shadow-lg hover:from-brand-700/90 hover:to-brand-900/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40" @click="toggle('catalog')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-sky-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7l9-4 9 4-9 4-9-4z"/><path d="M3 17l9 4 9-4"/><path d="M3 12l9 4 9-4"/></svg>
            Catálogo
          </span>
          <span class="text-slate-500">
            <svg x-show="!open.catalog" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            <svg x-show="open.catalog" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </span>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-sky-600/60" x-show="open.catalog" x-cloak x-transition>
          <a href="/catalog?tab=products" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-brand-900/40 hover:bg-brand-800/50">Produto</a>
          <a href="/catalog?tab=categories" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-brand-900/40 hover:bg-brand-800/50">Categoria</a>
          <a href="/catalog?tab=brands" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-brand-900/40 hover:bg-brand-800/50">Marca</a>
          <a href="/stock" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-brand-900/40 hover:bg-brand-800/50">Estoque</a>
        </div>
      </div>

      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-emerald-500/40" @click="toggle('people')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
            Cadastros
          </span>
          <span class="text-slate-500">
            <svg x-show="!open.people" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            <svg x-show="open.people" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </span>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-emerald-600/60" x-show="open.people" x-cloak x-transition>
          <a href="/people?tab=customers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Clientes</a>
          <a href="/people?tab=suppliers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Fornecedores</a>
          <a href="/people?tab=sellers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Vendedores</a>
        </div>
      </div>

      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-amber-500/40" @click="toggle('nfe')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h8M8 10h8M8 14h6"/></svg>
            NFe
          </span>
          <span class="text-slate-500">
            <svg x-show="!open.nfe" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            <svg x-show="open.nfe" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </span>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-amber-600/60" x-show="open.nfe" x-cloak x-transition>
          <a href="/nfe" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Importar XML</a>
          <a href="/nfe?tab=list" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Notas de Fornecedor</a>
        </div>
      </div>

      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-violet-500/40" @click="toggle('cashier')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-violet-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="14" rx="2"/></svg>
            Caixa
          </span>
          <span class="text-slate-500">
            <svg x-show="!open.cashier" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            <svg x-show="open.cashier" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </span>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-violet-600/60" x-show="open.cashier" x-cloak x-transition>
          <a href="/cashier" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Abrir/Fechar</a>
        </div>
      </div>

      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg shadow-slate-950/50 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40" @click="toggle('orders')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-sky-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13M8 12h13M8 18h13"/></svg>
            Pedidos
          </span>
          <span class="text-slate-500">
            <svg x-show="!open.orders" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            <svg x-show="open.orders" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </span>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-sky-600/60" x-show="open.orders" x-cloak x-transition>
          <a href="/sales" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500/40">Nova Venda</a>
          <a href="/orders" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500/40">Listagem</a>
        </div>
      </div>

      <!-- Administrativo (mobile) -->
      {% if request.user.is_staff %}
      <div>
        <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg shadow-slate-950/50 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-orange-500/40" @click="toggle('admin')">
          <span class="flex items-center gap-3">
            <svg class="h-5 w-5 text-orange-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9c.36 0 .7.07 1 .2"/></svg>
            Administrativo
          </span>
          <svg x-show="!open.admin" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.admin" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </button>
        <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-orange-600/60" x-show="open.admin" x-cloak x-transition>
          <a href="/price-review" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Revisão de Preço</a>
          <a href="/payments?tab=methods" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Formas de Pagamento</a>
          <a href="/payments?tab=card-brands" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Bandeiras</a>
          <a href="/payments?tab=card-fees" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Taxas</a>
          <a href="/nfe?tab=companies" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Emitentes</a>
          <a href="/payments?tab=receivables" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500/40">Recebíveis</a>
        </div>
      </div>
      {% endif %}

    </nav>
  </aside>
</div>
<!-- SIDEBAR MOBILE END -->

<!-- Desktop sidebar -->
<!-- SIDEBAR DESKTOP START -->
<aside class="hidden md:block w-64 border-r border-slate-800 bg-gradient-to-b from-slate-950/80 to-slate-900/60 backdrop-blur-lg" x-data="sidebar()" x-init="init()">
  <nav class="p-4 text-sm space-y-2">
    <div class="text-slate-400 uppercase tracking-wider text-xs mb-2">Menu</div>
    <a href="/home" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-slate-600/60 shadow-md shadow-slate-950/40 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40">
      <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg>
      <span>Home</span>
    </a>
    <a href="/" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-slate-600/60 shadow-md shadow-slate-950/40 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40">
      <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v7h-7zM3 14h7v7H3zM14 14h7v7h-7z"/></svg>
      <span>Dashboard</span>
    </a>

    <!-- Desktop groups -->
    <div @mouseenter="setHover('catalog')" @mouseleave="scheduleClose('catalog')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:shadow-sky-500/25 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-sky-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7l9-4 9 4-9 4-9-4z"/></svg>
          Catálogo
        </span>
        <span class="text-slate-500">
          <svg x-show="!open.catalog" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.catalog" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </span>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-sky-600/60" x-show="open.catalog" x-cloak x-transition>
        <a href="/catalog?tab=products" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Produto</a>
        <a href="/catalog?tab=categories" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Categoria</a>
        <a href="/catalog?tab=brands" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Marca</a>
        <a href="/stock" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Estoque</a>
      </div>
    </div>

    <div @mouseenter="setHover('people')" @mouseleave="scheduleClose('people')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:shadow-emerald-500/25 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-emerald-500/40">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
          Cadastros
        </span>
        <span class="text-slate-500">
          <svg x-show="!open.people" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.people" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </span>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-emerald-600/60" x-show="open.people" x-cloak x-transition>
        <a href="/people?tab=customers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Clientes</a>
        <a href="/people?tab=suppliers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Fornecedores</a>
        <a href="/people?tab=sellers" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Vendedores</a>
      </div>
    </div>

    <div @mouseenter="setHover('nfe')" @mouseleave="scheduleClose('nfe')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:shadow-amber-500/25 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-amber-500/40">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h8M8 10h8M8 14h6"/></svg>
          NFe
        </span>
        <span class="text-slate-500">
          <svg x-show="!open.nfe" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.nfe" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </span>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-amber-600/60" x-show="open.nfe" x-cloak x-transition>
        <a href="/nfe" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Importar XML</a>
        <a href="/nfe?tab=list" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Notas de Fornecedor</a>
        <a href="/nfe?tab=issued" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Notas Emitidas</a>
      </div>
    </div>

    <div @mouseenter="setHover('cashier')" @mouseleave="scheduleClose('cashier')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-violet-500/40" @click="toggle('cashier')">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-violet-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="14" rx="2"/></svg>
          Caixa
        </span>
        <span class="text-slate-500">
          <svg x-show="!open.cashier" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.cashier" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </span>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-violet-600/60" x-show="open.cashier" x-cloak x-transition>
        <a href="/cashier" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80">Abrir/Fechar</a>
      </div>
    </div>

    <div @mouseenter="setHover('orders')" @mouseleave="scheduleClose('orders')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg shadow-slate-950/50 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-sky-500/40" @click="toggle('orders')">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-sky-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13M8 12h13M8 18h13"/></svg>
          Pedidos
        </span>
        <span class="text-slate-500">
          <svg x-show="!open.orders" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          <svg x-show="open.orders" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
        </span>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-sky-600/60" x-show="open.orders" x-cloak x-transition>
        <a href="/sales" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500/40">Nova Venda</a>
        <a href="/orders" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500/40">Listagem</a>
      </div>
    </div>

    <!-- Administrativo (desktop hover) -->
    {% if request.user.is_staff %}
    <div @mouseenter="setHover('admin')" @mouseleave="scheduleClose('admin')">
      <button type="button" class="w-full text-left px-3 py-2 rounded-lg flex justify-between items-center bg-gradient-to-br from-slate-800/90 to-slate-950/90 border border-slate-600/70 shadow-lg shadow-slate-950/50 hover:shadow-orange-500/25 hover:bg-slate-800/90 focus:outline-none focus:ring-2 focus:ring-orange-500/40" @click="toggle('admin')">
        <span class="flex items-center gap-3">
          <svg class="h-5 w-5 text-orange-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9c.36 0 .7.07 1 .2"/></svg>
          Administrativo
        </span>
        <svg x-show="!open.admin" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
        <svg x-show="open.admin" class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
      </button>
      <div class="ml-6 pl-4 mt-1 space-y-1 border-l-2 border-orange-600/60" x-show="open.admin" x-cloak x-transition>
        <a href="/price-review" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Revisão de Preço</a>
        <a href="/payments?tab=methods" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Formas de Pagamento</a>
        <a href="/payments?tab=card-brands" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Bandeiras</a>
        <a href="/payments?tab=card-fees" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Taxas</a>
        <a href="/nfe?tab=companies" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Emitentes</a>
        <a href="/payments?tab=receivables" class="block px-3 py-1.5 rounded-lg text-slate-100 bg-slate-800/70 hover:bg-slate-700/80 shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500/40">Recebíveis</a>
      </div>
    </div>
    {% endif %}

  </nav>
</aside>
<!-- SIDEBAR DESKTOP END -->

<script>
  function sidebar(){
    return {
      sidebarVisible: false,
      open: { catalog:false, people:false, nfe:false, cashier:false, orders:false, admin:false },
      closeTimers: {},
      init(){
        const isDesktop = window.matchMedia('(min-width: 768px)').matches;
        if (!isDesktop) {
          try { const saved = JSON.parse(localStorage.getItem('sidebarOpen')||'{}'); this.open = { ...this.open, ...saved }; } catch(e){}
        } else {
          this.open = { catalog:false, people:false, nfe:false, cashier:false, orders:false, admin:false };
        }
      },
      toggle(key){
        this.open[key] = !this.open[key];
        try { localStorage.setItem('sidebarOpen', JSON.stringify(this.open)); } catch(e){}
      },
      setHover(key){ if (this.closeTimers[key]) { clearTimeout(this.closeTimers[key]); delete this.closeTimers[key]; } this.open[key] = true; },
      scheduleClose(key){ if (this.closeTimers[key]) { clearTimeout(this.closeTimers[key]); } this.closeTimers[key] = setTimeout(() => { this.open[key] = false; delete this.closeTimers[key]; }, 180); }
    }
  }
</script>
